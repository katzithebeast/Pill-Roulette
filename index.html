<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Pill Roulette</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Courier New', Courier, monospace; 
            color: white; 
            user-select: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        /* Vignette efekt - zatemnění po stranách pro hororový feel */
        /* Vignette efekt - zatemnění po stranách pro hororový feel */
        #vignette-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 998;
            background: radial-gradient(
                ellipse 80% 50% at 50% 50%,
                transparent 0%,
                transparent 25%,
                rgba(0, 0, 0, 0.5) 50%,
                rgba(0, 0, 0, 0.8) 75%,
                rgba(0, 0, 0, 0.95) 100%
            );
        }
        
        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Aby šlo klikat skrz UI na 3D objekty */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .hp-bar {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        #enemy-hp { color: #ff4444; text-align: center; }
        #player-hp { color: #44ff44; text-align: center; }
        #enemy-toxicity { 
            color: #ff4444; 
            text-align: center;
        }
        #player-toxicity { 
            color: #44ff44; 
            text-align: center;
        }
        
        .toxicity-icon {
            color: #888888;
            transition: color 0.3s ease;
        }
        
        .toxicity-icon.filled.level-1 { color: #ffff00; }
        .toxicity-icon.filled.level-2 { color: #ffaa00; }
        .toxicity-icon.filled.level-3 { color: #ff6600; }
        .toxicity-icon.filled.level-4 { color: #ff3300; }
        .toxicity-icon.filled.level-5 { color: #ff0000; }
        
        /* Main Menu Styles */
        .menu-btn {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
            padding: 12px 35px;
            cursor: pointer;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(0, 255, 0, 0.5);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3), inset 0 0 10px rgba(0, 0, 0, 0.5);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            transition: all 0.1s;
            min-width: 250px;
        }
        
        .menu-btn:hover {
            background: rgba(0, 50, 0, 0.95);
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.6), inset 0 0 15px rgba(0, 255, 0, 0.2);
            text-shadow: 2px 2px 0 #000, 0 0 15px rgba(0, 255, 0, 0.8);
            transform: scale(1.05);
        }
        
        .menu-btn:active {
            transform: scale(0.98);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.8);
        }
        
        /* CRT Scanlines Animation */
        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }
        
        /* Background parallax movement (fake 3D) */
        @keyframes bgParallax {
            0% { background-position: 50% 50%; }
            25% { background-position: 45% 50%; }
            50% { background-position: 50% 50%; }
            75% { background-position: 55% 50%; }
            100% { background-position: 50% 50%; }
        }
        
        /* CRT flicker effect */
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.98; }
        }
        
        #player-id {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.95);
            padding: 10px 15px;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 9px;
            font-weight: 100;
            text-shadow: 1px 1px 0 #000;
            pointer-events: none;
            color: #fff;
            z-index: 999;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.9), inset 0 0 10px rgba(0, 0, 0, 0.5);
            line-height: 1.6;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        #pill-stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.95);
            padding: 15px;
            border-radius: 0;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 10px;
            font-weight: normal;
            text-shadow: 1px 1px 0 #000;
            pointer-events: none;
            color: #fff;
            min-width: 180px;
            z-index: 999;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.9), inset 0 0 10px rgba(0, 0, 0, 0.5);
            line-height: 1.6;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .pill-stat-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pill-stat-icon {
            font-size: 16px;
            display: inline-block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            filter: contrast(1.3) brightness(0.85) saturate(1.2) blur(0.3px);
            transform: scale(0.75);
            transform-origin: center;
            vertical-align: middle;
            text-rendering: optimizeSpeed;
            -webkit-font-smoothing: none;
            -moz-osx-font-smoothing: unset;
            font-smooth: never;
        }

        #game-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none; /* Skryté, dokud není zpráva */
        }

        #controls-hint {
            text-align: center;
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        /* Efekty pro pilulky */
        #effect-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #effect-overlay.good-pill {
            background: radial-gradient(circle, rgba(138, 43, 226, 0.4) 0%, rgba(75, 0, 130, 0.3) 50%, transparent 70%);
        }

        #effect-overlay.bad-pill {
            background: #000;
        }

        @keyframes lsdTrip {
            0% { 
                opacity: 0;
                filter: hue-rotate(0deg) saturate(1);
                transform: scale(1);
            }
            10% {
                opacity: 0.6;
                filter: hue-rotate(90deg) saturate(1.5);
                transform: scale(1.05);
            }
            30% {
                opacity: 0.8;
                filter: hue-rotate(180deg) saturate(2);
                transform: scale(1.1);
            }
            50% { 
                opacity: 1;
                filter: hue-rotate(270deg) saturate(2.5);
                transform: scale(1.15);
            }
            70% {
                opacity: 0.8;
                filter: hue-rotate(360deg) saturate(2);
                transform: scale(1.1);
            }
            90% {
                opacity: 0.6;
                filter: hue-rotate(450deg) saturate(1.5);
                transform: scale(1.05);
            }
            100% { 
                opacity: 0;
                filter: hue-rotate(540deg) saturate(1);
                transform: scale(1);
            }
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes fadeToBlack {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @keyframes fadeFromBlack {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        #effect-overlay.animate-good {
            animation: lsdTrip 1.5s ease-in-out;
        }

        #effect-overlay.animate-bad {
            animation: fadeToBlack 0.5s ease forwards, fadeFromBlack 0.5s ease 1.5s forwards;
        }
        
        /* Debug panel pro zombie */
        #debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            display: none; /* Skryté ve výchozím stavu */
            z-index: 2000;
            pointer-events: all;
            min-width: 300px;
        }
        
        #debug-panel.active {
            display: block;
        }
        
        #debug-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 150, 0, 0.8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            z-index: 2001;
            pointer-events: all;
        }
        
        #debug-toggle:hover {
            background: rgba(0, 200, 0, 0.9);
        }
        
        .debug-control {
            margin: 15px 0;
        }
        
        .debug-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .debug-control input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }
        
        .debug-control .value {
            display: inline-block;
            min-width: 60px;
            text-align: right;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <button id="debug-toggle">DEBUG</button>
    
    <div id="debug-panel">
        <h3 style="margin-top: 0;">Zombie Debug</h3>
        
        <div class="debug-control">
            <label>Pozice X: <span class="value" id="debug-pos-x-val">-0.100</span></label>
            <input type="range" id="debug-pos-x" min="-10" max="10" step="0.1" value="-0.100">
        </div>
        
        <div class="debug-control">
            <label>Pozice Y: <span class="value" id="debug-pos-y-val">-1.400</span></label>
            <input type="range" id="debug-pos-y" min="-5" max="5" step="0.1" value="-1.400">
        </div>
        
        <div class="debug-control">
            <label>Pozice Z: <span class="value" id="debug-pos-z-val">-3.500</span></label>
            <input type="range" id="debug-pos-z" min="-10" max="5" step="0.1" value="-3.500">
        </div>
        
        <div class="debug-control">
            <label>Rotace X: <span class="value" id="debug-rot-x-val">-1.570</span></label>
            <input type="range" id="debug-rot-x" min="-3.14" max="3.14" step="0.01" value="-1.570">
        </div>
        
        <div class="debug-control">
            <label>Rotace Y: <span class="value" id="debug-rot-y-val">0.000</span></label>
            <input type="range" id="debug-rot-y" min="-3.14" max="3.14" step="0.01" value="0.000">
        </div>
        
        <div class="debug-control">
            <label>Rotace Z: <span class="value" id="debug-rot-z-val">0.090</span></label>
            <input type="range" id="debug-rot-z" min="-3.14" max="3.14" step="0.01" value="0.090">
        </div>
        
        <div class="debug-control">
            <label>Měřítko: <span class="value" id="debug-scale-val">4.700</span></label>
            <input type="range" id="debug-scale" min="0.1" max="5" step="0.1" value="4.700">
        </div>
        
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #555;">
            <h4 style="margin-top: 0;">Oponent - pozice pilulky</h4>
            
            <div class="debug-control">
                <label>Výška úst: <span class="value" id="debug-enemy-mouth-height-val">1.0</span></label>
                <input type="range" id="debug-enemy-mouth-height" min="0" max="5" step="0.1" value="1.0">
            </div>
        </div>
        
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #555;">
            <h4 style="margin-top: 0;">Krabička a víčko</h4>
            
            <div class="debug-control">
                <label>Měřítko krabičky: <span class="value" id="debug-bottle-cap-scale-val">1.0</span></label>
                <input type="range" id="debug-bottle-cap-scale" min="0.1" max="5" step="0.1" value="1.0">
            </div>
        </div>
        
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #555;">
            <h4 style="margin-top: 0;">Překlopení stolu</h4>
            
            <div class="debug-control">
                <label>Rotace X stolu: <span class="value" id="debug-table-rotation-x-val">0.00</span></label>
                <input type="range" id="debug-table-rotation-x" min="-3.14" max="3.14" step="0.01" value="0.00">
            </div>
        </div>
        
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #555;">
            <button id="debug-copy" style="width: 100%; padding: 10px; background: rgba(0, 100, 200, 0.8); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                Kopírovat hodnoty
            </button>
        </div>
    </div>
    
    <div id="ui-container">
        <div>
            <div id="enemy-hp">Oponent: ❤️❤️❤️❤️❤️</div>
            <div id="enemy-toxicity">Toxikace: </div>
        </div>
        
        <div id="game-status">Házím mincí...</div>

        <div>
            <div id="controls-hint">Klikni myší pro interakci</div>
            <div id="player-hp">Ty: ❤️❤️❤️❤️❤️</div>
            <div id="player-toxicity">Toxikace: </div>
        </div>
    </div>
    
    <!-- UI pro statistiky pilulek (vlevo nahoře) -->
    <div id="pill-stats"></div>
    
    <div id="player-id">Drug Addict# <span id="player-id-number">0000</span></div>
    
    <!-- Tooltip pro itemy -->
    <div id="item-tooltip" style="position: fixed; z-index: 2000; pointer-events: none; display: none; background: rgba(0, 0, 0, 0.95); color: white; border: 2px solid #444; font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 10px; padding: 8px 12px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.9); white-space: nowrap;"></div>
    
    <!-- Tlačítko pro spawn testovacích itemů s výběrem -->
    <div style="position: absolute; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 5px;">
        <select id="spawn-item-select" style="padding: 10px 20px; background: rgba(0, 0, 0, 0.95); color: white; border: 2px solid #444; font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 10px; cursor: pointer; pointer-events: all; box-shadow: 0 0 20px rgba(0, 0, 0, 0.9); appearance: none; -webkit-appearance: none; -moz-appearance: none; outline: none;">
            <option value="injector">INJECTOR</option>
            <option value="tester">TESTER</option>
            <option value="pliers">KLESTE</option>
            <option value="tooth">ZUB</option>
            <option value="candy">CANDY</option>
            <option value="brain">BRAIN</option>
            <option value="leech">LEECH</option>
            <option value="hammer">HAMMER</option>
            <option value="hearth">HEARTH</option>
        </select>
        <button id="spawn-item-btn" style="padding: 10px 20px; background: rgba(0, 0, 0, 0.95); color: white; border: 2px solid #444; font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 10px; cursor: pointer; pointer-events: all; box-shadow: 0 0 20px rgba(0, 0, 0, 0.9);">SPAWN</button>
    </div>
    
    <style>
        #spawn-item-select:hover {
            background: rgba(20, 20, 20, 0.95);
        }
        
        #spawn-item-select:focus {
            border-color: #666;
        }
        
        #spawn-item-btn:hover {
            background: rgba(20, 20, 20, 0.95);
        }
        
        #spawn-item-btn:active {
            background: rgba(40, 40, 40, 0.95);
        }
    </style>
 
    <!-- Overlay pro efekty pilulek -->
    <div id="effect-overlay"></div>
    
    <!-- Vignette efekt - zatemnění po stranách pro hororový feel -->
    <div id="vignette-overlay"></div>
    
    <!-- Main Menu -->
    <div id="main-menu" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 20000; pointer-events: all;">
        <!-- Background -->
        <div id="menu-background" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('models/textures/background_menu.png'); background-size: 120% 120%; background-position: center; z-index: 1; animation: bgParallax 10s ease-in-out infinite;"></div>
        
        <!-- CRT efekt overlay -->
        <div id="crt-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 3;">
            <!-- Scanlines -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.15) 0px, rgba(0, 0, 0, 0.15) 1px, transparent 1px, transparent 2px); pointer-events: none; animation: scanline 0.1s linear infinite;"></div>
            <!-- Zelený tint -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 100, 0, 0.1); mix-blend-mode: multiply; pointer-events: none;"></div>
            <!-- Vignette -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at center, transparent 0%, rgba(0, 0, 0, 0.3) 100%); pointer-events: none;"></div>
        </div>
        
        <!-- Menu content -->
        <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 60px; z-index: 2;">
            <!-- Logo -->
            <img id="menu-logo" src="models/textures/background_menu_icon.png" alt="Logo" style="max-width: 320px; width: 32%; height: auto; image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; margin-bottom: 25px; filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.8));">
            
            <!-- Menu buttons -->
            <div id="menu-buttons" style="display: flex; flex-direction: column; gap: 15px; align-items: center;">
                <button class="menu-btn" id="main-menu-btn-1" data-action="singleplayer">SINGLEPLAYER</button>
                <button class="menu-btn" id="main-menu-btn-2" data-action="multiplayer">MULTIPLAYER</button>
                <button class="menu-btn" data-action="howtoplay">HOW TO PLAY</button>
                <button class="menu-btn" data-action="options">OPTIONS</button>
            </div>
        </div>
        
        <!-- Pill icon vlevo dole -->
        <div style="position: absolute; bottom: 20px; left: 20px; z-index: 2;">
            <div style="width: 30px; height: 50px; background: linear-gradient(to right, #ff0000 0%, #ff0000 50%, #00ff00 50%, #00ff00 100%); border-radius: 15px; border: 2px solid #000; image-rendering: pixelated; box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);"></div>
        </div>
    </div>
    
    <!-- How to Play Overlay -->
    <div id="how-to-play-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 25000; pointer-events: all; background: rgba(0, 0, 0, 0.95);">
        <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; overflow-y: auto;">
            <div style="max-width: 800px; width: 100%; color: #00ff00; font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 10px; line-height: 1.6;">
                <h2 style="text-align: center; margin-bottom: 25px; font-size: 16px; text-shadow: 2px 2px 0 #000;">HOW TO PLAY</h2>
                <div style="margin-bottom: 18px;">
                    <h3 style="font-size: 12px; margin-bottom: 8px; color: #ffff00;">CÍL HRY</h3>
                    <p style="font-size: 10px;">Přežij co nejdéle a znič oponenta pomocí jedovatých pilulek. Každé kolo si vyber pilulku - některé jsou jedovaté, některé pomáhají. Máš 5 životů. Pokud sníš jedovatou pilulku, ztratíš 1 život. Pokud sníš normální pilulku, nic se nestane. Na konci každého kola si můžeš v shopu vybrat 2 itemy, které ti pomohou v dalších kolech.</p>
                </div>
                <div style="margin-bottom: 18px;">
                    <h3 style="font-size: 12px; margin-bottom: 8px; color: #ffff00;">OVLÁDÁNÍ</h3>
                    <p style="font-size: 10px;">• Klikni a táhni lahev/pilulky/itemy pro pohyb<br>• Klikni na pilulku pro snězení<br>• Drž item a stiskni E pro použití<br>• Klikni na minci pro hod (na začátku kola)</p>
                </div>
                <div style="margin-bottom: 18px;">
                    <h3 style="font-size: 12px; margin-bottom: 8px; color: #ffff00;">ITEMY</h3>
                    <p style="font-size: 10px;">• INJECTOR: Neguje 2 toxicity z příští pilulky (neskipne kolo)<br>• TESTER: Otestuj pilulku před snězením - klikni na pilulku po použití testeru (neskipne kolo)<br>• KLESTE: Přidá 1 toxicity oponentovi (neskipne kolo)<br>• ZUB: Neguje efekt kleští (neskipne kolo)<br>• CANDY: Sní se místo pilulky, přeskočí kolo<br>• BRAIN: Oponent sní vybranou pilulku (neskipne kolo)<br>• LEECH: Sníží toxicity na minimum (0) (neskipne kolo)<br>• HAMMER: Zničí vybranou pilulku (neskipne kolo)<br>• HEARTH: Přidá 1 život (max 5) (neskipne kolo)</p>
                </div>
                <div style="margin-bottom: 18px;">
                    <h3 style="font-size: 12px; margin-bottom: 8px; color: #ffff00;">PILULKY</h3>
                    <p style="font-size: 10px;">• Normální pilulka: Bílá/červená - může být jedovatá nebo ne<br>• Pill tablet: Světle modrá - může být jedovatá, nebo redukuje toxicity<br>• Vitamin pill: Zelená - může být jedovatá, nebo přidává toxicity<br>• Special pill: Polovina zelená, polovina fialová - může být smrtelná, přidat 2 toxicity, nebo přidat 1 život</p>
                </div>
                <button class="menu-btn" data-action="back-from-howto" style="margin-top: 25px; width: 200px;">BACK</button>
            </div>
        </div>
    </div>
    
    <!-- Options Overlay -->
    <div id="options-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 25000; pointer-events: all; background: rgba(0, 0, 0, 0.95);">
        <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px;">
            <div style="max-width: 600px; width: 100%; color: #00ff00; font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 12px;">
                <h2 style="text-align: center; margin-bottom: 30px; font-size: 18px; text-shadow: 2px 2px 0 #000;">OPTIONS</h2>
                <div style="margin-bottom: 30px; display: flex; align-items: center; justify-content: space-between;">
                    <label style="color: #00ff00;">DEVELOPER MODE:</label>
                    <input type="checkbox" id="dev-mode-toggle" style="width: 30px; height: 30px; cursor: pointer;">
                </div>
                <button class="menu-btn" data-action="back-from-options" style="margin-top: 30px; width: 200px;">BACK</button>
            </div>
        </div>
    </div>
    
    <!-- Shop UI -->
    <div id="shop-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; pointer-events: all;">
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); background: rgba(0, 0, 0, 0.3);"></div>
        <div style="position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 30px; z-index: 1;">
            <h2 style="font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 24px; color: white; text-shadow: 2px 2px 0 #000;">SHOP - SELECT 2 ITEMS</h2>
            <div id="shop-items-container" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; max-width: 1200px;">
                <!-- Shop items will be generated here -->
            </div>
            <div id="shop-selection-info" style="font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 14px; color: white; text-shadow: 1px 1px 0 #000;">
                Selected: <span id="shop-selected-count">0</span> / 2
            </div>
            <button id="shop-confirm-btn" style="padding: 15px 40px; background: rgba(0, 150, 0, 0.9); color: white; border: 2px solid #444; font-family: 'Press Start 2P', 'Courier New', monospace; font-size: 14px; cursor: pointer; pointer-events: all; box-shadow: 0 0 20px rgba(0, 0, 0, 0.9); display: none;">CONFIRM</button>
        </div>
    </div>

    <!-- Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "cannon-es": "https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"
            }
        }
    </script>

    <script type="module" src="game.js"></script>
    
    <script>
        // Main Menu Logic
        let isDevModeEnabled = false;
        
        // Menu button handlers
        document.addEventListener('DOMContentLoaded', () => {
            const menuButtons = document.querySelectorAll('.menu-btn');
            const mainMenu = document.getElementById('main-menu');
            const howToPlayOverlay = document.getElementById('how-to-play-overlay');
            const optionsOverlay = document.getElementById('options-overlay');
            const devModeToggle = document.getElementById('dev-mode-toggle');
            const spawnControls = document.querySelector('#spawn-item-select')?.parentElement;
            
            // Check if dev mode was saved
            const savedDevMode = localStorage.getItem('devMode');
            if (savedDevMode === 'true') {
                isDevModeEnabled = true;
                if (devModeToggle) devModeToggle.checked = true;
            }
            updateDevModeVisibility();
            
            const mainMenuBtn1 = document.getElementById('main-menu-btn-1');
            const mainMenuBtn2 = document.getElementById('main-menu-btn-2');
            let isGamePaused = false;
            
            // Function to update menu buttons based on game state
            function updateMenuButtons() {
                if (isGamePaused) {
                    // Game is paused - show RESUME and GIVE UP
                    if (mainMenuBtn1) {
                        mainMenuBtn1.textContent = 'RESUME';
                        mainMenuBtn1.setAttribute('data-action', 'resume');
                    }
                    if (mainMenuBtn2) {
                        mainMenuBtn2.textContent = 'GIVE UP';
                        mainMenuBtn2.setAttribute('data-action', 'giveup');
                    }
                } else {
                    // Main menu - show SINGLEPLAYER and MULTIPLAYER
                    if (mainMenuBtn1) {
                        mainMenuBtn1.textContent = 'SINGLEPLAYER';
                        mainMenuBtn1.setAttribute('data-action', 'singleplayer');
                    }
                    if (mainMenuBtn2) {
                        mainMenuBtn2.textContent = 'MULTIPLAYER';
                        mainMenuBtn2.setAttribute('data-action', 'multiplayer');
                    }
                }
            }
            
            // Function to resume game
            function resumeGame() {
                isGamePaused = false;
                mainMenu.style.display = 'none';
                updateMenuButtons();
            }
            
            // Function to give up (reset game)
            function giveUp() {
                if (confirm('Are you sure you want to give up? This will end your current run.')) {
                    // Refresh page to reset everything
                    window.location.reload();
                }
            }
            
            // ESC key handler for pause menu
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' || e.key === 'Esc') {
                    // If game is running and menu is hidden, show pause menu
                    if (window.gameInitialized && mainMenu.style.display === 'none') {
                        isGamePaused = true;
                        updateMenuButtons();
                        mainMenu.style.display = 'block';
                    }
                    // If menu is visible and game is paused, resume
                    else if (isGamePaused && mainMenu.style.display !== 'none') {
                        resumeGame();
                    }
                }
            });
            
            // Expose functions globally
            window.resumeGame = resumeGame;
            window.giveUp = giveUp;
            window.updateMenuButtons = updateMenuButtons;
            window.isGamePaused = () => isGamePaused;
            window.setGamePaused = (paused) => { isGamePaused = paused; };
            
            menuButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const action = btn.getAttribute('data-action');
                    
                    switch(action) {
                        case 'singleplayer':
                            mainMenu.style.display = 'none';
                            isGamePaused = false;
                            // Start game
                            if (window.startGame) {
                                window.startGame();
                            }
                            break;
                        case 'resume':
                            resumeGame();
                            break;
                        case 'giveup':
                            giveUp();
                            break;
                        case 'multiplayer':
                            // Placeholder for future multiplayer
                            alert('MULTIPLAYER - Coming soon!');
                            break;
                        case 'howtoplay':
                            howToPlayOverlay.style.display = 'block';
                            break;
                        case 'options':
                            optionsOverlay.style.display = 'block';
                            break;
                        case 'back-from-howto':
                            howToPlayOverlay.style.display = 'none';
                            break;
                        case 'back-from-options':
                            optionsOverlay.style.display = 'none';
                            break;
                    }
                });
            });
            
            // Dev mode toggle
            if (devModeToggle) {
                devModeToggle.addEventListener('change', (e) => {
                    isDevModeEnabled = e.target.checked;
                    localStorage.setItem('devMode', isDevModeEnabled);
                    updateDevModeVisibility();
                });
            }
            
            function updateDevModeVisibility() {
                if (spawnControls) {
                    spawnControls.style.display = isDevModeEnabled ? 'flex' : 'none';
                }
                // Also update debug panel if it exists
                const debugPanel = document.getElementById('debug-panel');
                const debugToggle = document.getElementById('debug-toggle');
                if (debugPanel && debugToggle) {
                    if (!isDevModeEnabled) {
                        debugPanel.style.display = 'none';
                        debugToggle.style.display = 'none';
                    } else {
                        debugToggle.style.display = 'block';
                    }
                }
            }
            
            // Hide game UI initially
            const gameUI = document.getElementById('ui-container');
            const pillStats = document.getElementById('pill-stats');
            const playerId = document.getElementById('player-id');
            if (gameUI) gameUI.style.display = 'none';
            if (pillStats) pillStats.style.display = 'none';
            if (playerId) playerId.style.display = 'none';
            
            // Show game UI when starting
            window.showGameUI = function() {
                if (gameUI) gameUI.style.display = 'flex';
                if (pillStats) pillStats.style.display = 'block';
                if (playerId) playerId.style.display = 'block';
            };
        });
    </script>
</body>
</html>